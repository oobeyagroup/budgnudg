{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h2>{{ profile.name }}</h2>
  <div>
    <a href="{% url 'ingest:profile_list' %}" class="btn btn-secondary">Back to List</a>
    <a href="/admin/ingest/FinancialAccount/{{ profile.pk }}/change/" class="btn btn-primary">Edit Profile</a>
  </div>
</div>

<p class="text-muted mt-2">{{ profile.description|default:"No description provided" }}</p>

<div class="row mt-4">
  <div class="col-md-8">
    <h4>Column Mappings</h4>
    {% if profile.column_map %}
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>CSV Column</th>
            <th>Transaction Field</th>
          </tr>
        </thead>
        <tbody>
          {% for csv_col, txn_field in profile.column_map.items %}
          <tr>
            <td><code>{{ csv_col }}</code></td>
            <td><span class="badge bg-primary">{{ txn_field }}</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-warning">
        <p class="mb-0">No column mappings defined for this profile.</p>
      </div>
    {% endif %}
  </div>

  <div class="col-md-4">
    <h4>Profile Info</h4>
    <table class="table table-sm">
      <tbody>
        <tr>
          <th>ID:</th>
          <td>{{ profile.pk }}</td>
        </tr>
        <tr>
          <th>Name:</th>
          <td>{{ profile.name }}</td>
        </tr>
        <tr>
          <th>Mappings:</th>
          <td>{{ profile.column_map|length }} fields</td>
        </tr>
      </tbody>
    </table>

    {% if profile.options %}
    <h5 class="mt-3">Options</h5>
    <pre class="bg-light p-2 small"><code>{{ profile.options|pprint }}</code></pre>
    {% endif %}
  </div>
</div>

<div class="mt-4">
  <h4>Recent Batches</h4>
  {% with recent_batches=profile.importbatch_set.all|slice:":5" %}
    {% if recent_batches %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Batch ID</th>
            <th>Filename</th>
            <th>Status</th>
            <th>Rows</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody>
          {% for batch in recent_batches %}
          <tr>
            <td><a href="{% url 'ingest:batch_preview' batch.pk %}">{{ batch.pk }}</a></td>
            <td>{{ batch.source_filename }}</td>
            <td><span class="badge bg-secondary">{{ batch.status }}</span></td>
            <td>{{ batch.row_count }}</td>
            <td>{{ batch.created_at|date:"M d, Y H:i" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No batches have used this profile yet.</p>
    {% endif %}
  {% endwith %}
</div>
{% endblock %}
